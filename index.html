<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Database Enrichment Analysis Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #ecf0f1;
            --dark-text: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--dark-text);
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .dropdown-container {
            flex: 1;
            min-width: 300px;
        }

        .dropdown-container label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-text);
        }

        select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:hover {
            border-color: var(--secondary-color);
        }

        select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-badge {
            background: var(--light-bg);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .card h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 0.5rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 2rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .pathway-item {
            background: var(--light-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .pathway-item:hover {
            transform: translateX(5px);
            box-shadow: var(--box-shadow);
        }

        .pathway-item.expanded {
            background: white;
            border-left-color: var(--danger-color);
        }

        .pathway-title {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .pathway-stats {
            display: flex;
            gap: 1rem;
            margin: 0.5rem 0;
        }

        .stat-pill {
            background: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .up { color: var(--danger-color); }
        .down { color: var(--secondary-color); }

        .gene-list {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: var(--light-bg);
        }

        .network-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background: white;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: var(--border-radius);
        }

        .gene-details {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .gene-details.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .gene-chip {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            background: var(--light-bg);
        }

        .gene-chip.up {
            background: #ffebee;
            color: var(--danger-color);
        }

        .gene-chip.down {
            background: #e3f2fd;
            color: var(--secondary-color);
        }

        .network-tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
            z-index: 1000;
        }

        .network-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .control-btn:hover {
            background: #2980b9;
        }

        .gene-search {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .stats {
                flex-direction: column;
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Multi-Database Enrichment Analysis Dashboard</h1>
            <p>Comprehensive pathway and functional enrichment analysis across multiple databases</p>
        </div>

        <div class="controls">
            <div class="dropdown-container">
                <label for="analysisType">Select Analysis Type:</label>
                <select id="analysisType" onchange="switchAnalysis(this.value)">
                    <option value="go">GO Enrichment</option>
                    <option value="kegg">KEGG Enrichment</option>
                    <option value="reactome">Reactome Enrichment</option>
                    <option value="do">Disease Ontology (DO)</option>
                    <option value="disgenet">DisGeNET</option>
                    <option value="gsea">Gene Set Enrichment</option>
                    <option value="oncogene">Oncogene Annotation</option>
                    <option value="ppi">Protein-Protein Interaction</option>
                </select>
            </div>
            <div class="stats">
                <div class="stat-badge">Total Genes: 18,694</div>
                <div class="stat-badge up">Up: 3,312</div>
                <div class="stat-badge down">Down: 2,530</div>
            </div>
        </div>

        <!-- GO Enrichment Section -->
        <div id="go-section" class="content-section active">
            <div class="card">
                <h2>Gene Ontology (GO) Enrichment Analysis</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> GO enrichment for significantly differentially expressed genes (|log2FC| > 1)
                </div>
                
                <div class="grid">
                    <div class="chart-container">
                        <canvas id="goChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="goCategoryChart"></canvas>
                    </div>
                </div>

                <h3>Top Enriched GO Terms</h3>
                <div id="goPathways" class="grid"></div>
            </div>
        </div>

        <!-- KEGG Section -->
        <div id="kegg-section" class="content-section">
            <div class="card">
                <h2>KEGG Pathway Enrichment Analysis</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> KEGG pathway mapping for differentially expressed genes
                </div>
                
                <div class="chart-container">
                    <canvas id="keggChart"></canvas>
                </div>

                <h3>Enriched KEGG Pathways</h3>
                <div id="keggPathways" class="grid"></div>
            </div>
        </div>

        <!-- Reactome Section -->
        <div id="reactome-section" class="content-section">
            <div class="card">
                <h2>Reactome Pathway Analysis</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> Reactome pathway enrichment focusing on cellular processes
                </div>
                
                <div class="chart-container">
                    <canvas id="reactomeChart"></canvas>
                </div>

                <h3>Top Reactome Pathways</h3>
                <div id="reactomePathways"></div>
            </div>
        </div>

        <!-- Disease Ontology Section -->
        <div id="do-section" class="content-section">
            <div class="card">
                <h2>Disease Ontology (DO) Enrichment</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> Disease associations for differentially expressed genes
                </div>
                
                <div class="chart-container">
                    <canvas id="doChart"></canvas>
                </div>

                <h3>Disease Associations</h3>
                <table id="doTable">
                    <thead>
                        <tr>
                            <th>Disease</th>
                            <th>Category</th>
                            <th>Associated Genes</th>
                            <th>Enrichment Score</th>
                        </tr>
                    </thead>
                    <tbody id="doTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- DisGeNET Section -->
        <div id="disgenet-section" class="content-section">
            <div class="card">
                <h2>DisGeNET Disease-Gene Associations</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> Curated gene-disease associations from DisGeNET database
                </div>
                
                <div class="chart-container">
                    <canvas id="disgenetChart"></canvas>
                </div>

                <h3>Gene-Disease Network</h3>
                <div id="disgenetNetwork" class="network-container"></div>
            </div>
        </div>

        <!-- Gene Set Enrichment Section -->
        <div id="gsea-section" class="content-section">
            <div class="card">
                <h2>Gene Set Enrichment Analysis (GSEA)</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> Enrichment of predefined gene sets in ranked gene list
                </div>
                
                <div class="chart-container">
                    <canvas id="gseaChart"></canvas>
                </div>

                <h3>Enrichment Plot</h3>
                <div id="gseaPlot" class="chart-container"></div>
            </div>
        </div>

        <!-- Oncogene Section -->
        <div id="oncogene-section" class="content-section">
            <div class="card">
                <h2>Oncogene and Tumor Suppressor Annotation</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> Cancer-related gene annotations and expression changes
                </div>
                
                <div class="grid">
                    <div class="chart-container">
                        <canvas id="oncogeneChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="cancerTypeChart"></canvas>
                    </div>
                </div>

                <h3>Cancer Gene Details</h3>
                <table id="oncogeneTable">
                    <thead>
                        <tr>
                            <th>Gene</th>
                            <th>Type</th>
                            <th>Log2 FC</th>
                            <th>Associated Cancers</th>
                        </tr>
                    </thead>
                    <tbody id="oncogeneTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- PPI Section -->
        <div id="ppi-section" class="content-section">
            <div class="card">
                <h2>Protein-Protein Interaction Network</h2>
                <div class="info-box">
                    <strong>Analysis:</strong> Network analysis of protein interactions for DE genes
                </div>
                
                <div id="ppiNetwork" class="network-container"></div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>Upregulated</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>Downregulated</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #95a5a6;"></div>
                        <span>No change</span>
                    </div>
                </div>

                <h3>Network Statistics</h3>
                <div class="grid">
                    <div class="pathway-item">
                        <div class="pathway-title">Hub Genes</div>
                        <div id="hubGenes"></div>
                    </div>
                    <div class="pathway-item">
                        <div class="pathway-title">Network Metrics</div>
                        <div id="networkMetrics"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data for all analyses
        const analysisData = {
            go: {
                terms: [
                    { 
                        id: "GO:0001525", 
                        name: "angiogenesis", 
                        category: "BP", 
                        genes: 5, 
                        up: 3, 
                        down: 2, 
                        pvalue: 0.001,
                        upGenes: ["VEGFA", "HIF1A", "ANGPT2"],
                        downGenes: ["FLT1", "KDR"]
                    },
                    { 
                        id: "GO:0006629", 
                        name: "lipid metabolic process", 
                        category: "BP", 
                        genes: 12, 
                        up: 7, 
                        down: 5, 
                        pvalue: 0.0001,
                        upGenes: ["FASN", "ACACA", "SCD", "SREBF1", "PPARA", "PPARG", "LDLR"],
                        downGenes: ["APOB", "LIPC", "LPL", "CETP", "LIPA"]
                    },
                    { 
                        id: "GO:0042127", 
                        name: "regulation of cell proliferation", 
                        category: "BP", 
                        genes: 8, 
                        up: 5, 
                        down: 3, 
                        pvalue: 0.005,
                        upGenes: ["MYC", "CCND1", "CDK4", "E2F1", "STAT3"],
                        downGenes: ["CDKN1A", "RB1", "TP53"]
                    },
                    { 
                        id: "GO:0005634", 
                        name: "nucleus", 
                        category: "CC", 
                        genes: 15, 
                        up: 8, 
                        down: 7, 
                        pvalue: 0.002,
                        upGenes: ["HIF1A", "MYC", "JUN", "FOS", "STAT3", "NFKB1", "E2F1", "SP1"],
                        downGenes: ["TP53", "RB1", "CDKN1A", "FOXO1", "FOXO3", "SMAD4", "PTEN"]
                    },
                    { 
                        id: "GO:0005737", 
                        name: "cytoplasm", 
                        category: "CC", 
                        genes: 20, 
                        up: 12, 
                        down: 8, 
                        pvalue: 0.001,
                        upGenes: ["AKT1", "MAPK1", "MAPK3", "PIK3CA", "MTOR", "GSK3B", "SRC", "RAF1", "KRAS", "RHOA", "CDC42", "RAC1"],
                        downGenes: ["PTEN", "TSC1", "TSC2", "NF1", "SIRT1", "AMPK", "LKB1", "BECN1"]
                    },
                    { 
                        id: "GO:0004672", 
                        name: "protein kinase activity", 
                        category: "MF", 
                        genes: 6, 
                        up: 4, 
                        down: 2, 
                        pvalue: 0.01,
                        upGenes: ["AKT1", "MAPK1", "CDK4", "SRC"],
                        downGenes: ["AMPK", "LKB1"]
                    }
                ]
            },
            kegg: {
                pathways: [
                    { 
                        id: "hsa04370", 
                        name: "VEGF signaling pathway", 
                        genes: 15, 
                        up: 8, 
                        down: 7, 
                        enrichment: 2.5,
                        upGenes: ["VEGFA", "MAPK1", "MAPK3", "AKT1", "PIK3CA", "SRC", "RAF1", "PXN"],
                        downGenes: ["KDR", "FLT1", "FLT4", "PTEN", "PPP3CA", "PRKCG", "BAD"]
                    },
                    { 
                        id: "hsa04066", 
                        name: "HIF-1 signaling pathway", 
                        genes: 12, 
                        up: 7, 
                        down: 5, 
                        enrichment: 2.1,
                        upGenes: ["HIF1A", "VEGFA", "EPO", "MTOR", "AKT1", "PIK3CA", "STAT3"],
                        downGenes: ["VHL", "EGLN1", "FIH1", "PTEN", "TSC2"]
                    },
                    { 
                        id: "hsa04151", 
                        name: "PI3K-Akt signaling pathway", 
                        genes: 18, 
                        up: 11, 
                        down: 7, 
                        enrichment: 1.8,
                        upGenes: ["AKT1", "PIK3CA", "MTOR", "MDM2", "CCND1", "CDK4", "VEGFA", "EGFR", "IGF1", "PDGFA", "MYC"],
                        downGenes: ["PTEN", "TSC1", "TSC2", "FOXO1", "FOXO3", "CDKN1A", "CDKN1B"]
                    },
                    { 
                        id: "hsa04010", 
                        name: "MAPK signaling pathway", 
                        genes: 20, 
                        up: 12, 
                        down: 8, 
                        enrichment: 1.6,
                        upGenes: ["MAPK1", "MAPK3", "MAP2K1", "MAP2K2", "RAF1", "KRAS", "EGFR", "PDGFA", "FGF2", "MYC", "JUN", "FOS"],
                        downGenes: ["DUSP1", "DUSP5", "DUSP6", "NF1", "RASA1", "MAP3K5", "GADD45A", "TP53"]
                    },
                    { 
                        id: "hsa04330", 
                        name: "Notch signaling pathway", 
                        genes: 8, 
                        up: 5, 
                        down: 3, 
                        enrichment: 1.4,
                        upGenes: ["NOTCH1", "DLL4", "JAG1", "HES1", "HEY1"],
                        downGenes: ["NUMB", "FBXW7", "MAML1"]
                    }
                ]
            },
            gsea: {
                geneSets: [
                    { 
                        name: 'Angiogenesis', 
                        es: 0.65, 
                        nes: 2.1, 
                        pval: 0.001,
                        leadingEdge: ["VEGFA", "HIF1A", "ANGPT1", "ANGPT2", "TEK", "KDR", "FLT1", "NRP1", "EPHB2", "EPHB4"],
                        size: 50
                    },
                    { 
                        name: 'Lipid Metabolism', 
                        es: -0.58, 
                        nes: -1.9, 
                        pval: 0.002,
                        leadingEdge: ["SCD", "FASN", "ACACA", "SREBF1", "PPARA", "LDLR", "APOB", "LIPC", "LPL", "HMGCR"],
                        size: 45
                    },
                    { 
                        name: 'Cell Cycle', 
                        es: 0.52, 
                        nes: 1.8, 
                        pval: 0.005,
                        leadingEdge: ["CCND1", "CDK4", "CDK6", "E2F1", "RB1", "CDKN1A", "CDKN1B", "MYC", "PCNA", "MCM2"],
                        size: 60
                    },
                    { 
                        name: 'Apoptosis', 
                        es: -0.45, 
                        nes: -1.6, 
                        pval: 0.01,
                        leadingEdge: ["BCL2", "BCL2L1", "BAX", "BAD", "BID", "CASP3", "CASP9", "APAF1", "CYCS", "TP53"],
                        size: 40
                    },
                    { 
                        name: 'MAPK Signaling', 
                        es: 0.42, 
                        nes: 1.5, 
                        pval: 0.02,
                        leadingEdge: ["MAPK1", "MAPK3", "MAP2K1", "RAF1", "KRAS", "EGFR", "JUN", "FOS", "MYC", "ELK1"],
                        size: 55
                    }
                ]
            },
            reactome: {
                pathways: [
                    { id: "R-HSA-194138", name: "Signaling by VEGF", score: 3.2, genes: ["VEGFA", "KDR", "FLT1"] },
                    { id: "R-HSA-1234174", name: "Cellular response to hypoxia", score: 2.8, genes: ["HIF1A", "EPAS1", "VHL"] },
                    { id: "R-HSA-556833", name: "Metabolism of lipids", score: 2.5, genes: ["SCD", "FASN", "ACACA"] },
                    { id: "R-HSA-162582", name: "Signal Transduction", score: 2.2, genes: ["AKT1", "MAPK1", "STAT3"] },
                    { id: "R-HSA-1640170", name: "Cell Cycle", score: 1.9, genes: ["CCND1", "CDK4", "RB1"] }
                ]
            },
            diseases: {
                associations: [
                    { disease: "Cancer", genes: 25, score: 4.5 },
                    { disease: "Cardiovascular disease", genes: 18, score: 3.8 },
                    { disease: "Metabolic syndrome", genes: 15, score: 3.2 },
                    { disease: "Diabetes", genes: 12, score: 2.9 },
                    { disease: "Obesity", genes: 10, score: 2.5 }
                ]
            },
            oncogenes: [
                { gene: "MYC", type: "oncogene", fc: 2.3, cancers: ["lymphoma", "neuroblastoma"] },
                { gene: "KRAS", type: "oncogene", fc: 1.8, cancers: ["pancreatic", "colorectal"] },
                { gene: "TP53", type: "tumor_suppressor", fc: -1.5, cancers: ["various"] },
                { gene: "PTEN", type: "tumor_suppressor", fc: -1.2, cancers: ["glioblastoma", "prostate"] },
                { gene: "VEGFA", type: "angiogenic", fc: 1.9, cancers: ["tumor angiogenesis"] }
            ]
        };

        // Chart instances
        let charts = {};

        // Initialize the dashboard
        function initDashboard() {
            drawGOCharts();
        }

        // Switch between analyses
        function switchAnalysis(type) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(`${type}-section`).classList.add('active');

            // Draw appropriate charts
            switch(type) {
                case 'go':
                    drawGOCharts();
                    break;
                case 'kegg':
                    drawKEGGCharts();
                    break;
                case 'reactome':
                    drawReactomeCharts();
                    break;
                case 'do':
                    drawDOCharts();
                    break;
                case 'disgenet':
                    drawDisGeNETCharts();
                    break;
                case 'gsea':
                    drawGSEACharts();
                    break;
                case 'oncogene':
                    drawOncogeneCharts();
                    break;
                case 'ppi':
                    drawPPINetwork();
                    break;
            }
        }

        // GO Enrichment Charts
        function drawGOCharts() {
            // GO terms bar chart
            const goCtx = document.getElementById('goChart').getContext('2d');
            if (charts.go) charts.go.destroy();
            
            charts.go = new Chart(goCtx, {
                type: 'bar',
                data: {
                    labels: analysisData.go.terms.map(t => t.name),
                    datasets: [{
                        label: 'Number of Genes',
                        data: analysisData.go.terms.map(t => t.genes),
                        backgroundColor: analysisData.go.terms.map(t => 
                            t.category === 'BP' ? '#3498db' : 
                            t.category === 'CC' ? '#2ecc71' : '#e74c3c'
                        )
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'GO Term Enrichment'
                        }
                    }
                }
            });

            // Category distribution
            const categoryCtx = document.getElementById('goCategoryChart').getContext('2d');
            if (charts.goCategory) charts.goCategory.destroy();
            
            const categories = { BP: 0, CC: 0, MF: 0 };
            analysisData.go.terms.forEach(t => categories[t.category]++);
            
            charts.goCategory = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Biological Process', 'Cellular Component', 'Molecular Function'],
                    datasets: [{
                        data: [categories.BP, categories.CC, categories.MF],
                        backgroundColor: ['#3498db', '#2ecc71', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'GO Category Distribution'
                        }
                    }
                }
            });

            // Pathway cards with click functionality
            const pathwaysHTML = analysisData.go.terms.map((term, idx) => `
                <div class="pathway-item" onclick="toggleGODetails('${idx}')">
                    <div class="pathway-title">${term.name}</div>
                    <div class="pathway-stats">
                        <span class="stat-pill">${term.id}</span>
                        <span class="stat-pill">${term.category}</span>
                        <span class="stat-pill">p=${term.pvalue}</span>
                    </div>
                    <div class="gene-list">
                        <span class="up">${term.up} upregulated</span>, 
                        <span class="down">${term.down} downregulated</span>
                    </div>
                    <div id="go-details-${idx}" class="gene-details">
                        <div style="margin-bottom: 0.5rem;"><strong>Upregulated genes:</strong></div>
                        <div>${term.upGenes.map(g => `<span class="gene-chip up">${g}</span>`).join('')}</div>
                        <div style="margin: 0.5rem 0;"><strong>Downregulated genes:</strong></div>
                        <div>${term.downGenes.map(g => `<span class="gene-chip down">${g}</span>`).join('')}</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('goPathways').innerHTML = pathwaysHTML;
        }

        // Toggle GO details
        function toggleGODetails(idx) {
            const details = document.getElementById(`go-details-${idx}`);
            const item = details.parentElement;
            
            if (details.classList.contains('show')) {
                details.classList.remove('show');
                item.classList.remove('expanded');
            } else {
                // Close all other details
                document.querySelectorAll('.gene-details').forEach(d => d.classList.remove('show'));
                document.querySelectorAll('.pathway-item').forEach(i => i.classList.remove('expanded'));
                
                details.classList.add('show');
                item.classList.add('expanded');
            }
        }

        // KEGG Charts
        function drawKEGGCharts() {
            const keggCtx = document.getElementById('keggChart').getContext('2d');
            if (charts.kegg) charts.kegg.destroy();
            
            charts.kegg = new Chart(keggCtx, {
                type: 'bar',
                data: {
                    labels: analysisData.kegg.pathways.map(p => p.name),
                    datasets: [{
                        label: 'Enrichment Score',
                        data: analysisData.kegg.pathways.map(p => p.enrichment),
                        backgroundColor: '#e74c3c'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'KEGG Pathway Enrichment Scores'
                        }
                    }
                }
            });

            // Pathway details with click functionality
            const keggHTML = analysisData.kegg.pathways.map((pathway, idx) => `
                <div class="pathway-item" onclick="toggleKEGGDetails('${idx}')">
                    <div class="pathway-title">${pathway.name}</div>
                    <div class="pathway-stats">
                        <span class="stat-pill">${pathway.id}</span>
                        <span class="stat-pill">Score: ${pathway.enrichment}</span>
                    </div>
                    <div class="gene-list">
                        ${pathway.genes} genes: <span class="up">${pathway.up} up</span>, <span class="down">${pathway.down} down</span>
                    </div>
                    <div id="kegg-details-${idx}" class="gene-details">
                        <div style="margin-bottom: 0.5rem;"><strong>Upregulated genes:</strong></div>
                        <div>${pathway.upGenes.map(g => `<span class="gene-chip up">${g}</span>`).join('')}</div>
                        <div style="margin: 0.5rem 0;"><strong>Downregulated genes:</strong></div>
                        <div>${pathway.downGenes.map(g => `<span class="gene-chip down">${g}</span>`).join('')}</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('keggPathways').innerHTML = keggHTML;
        }

        // Toggle KEGG details
        function toggleKEGGDetails(idx) {
            const details = document.getElementById(`kegg-details-${idx}`);
            const item = details.parentElement;
            
            if (details.classList.contains('show')) {
                details.classList.remove('show');
                item.classList.remove('expanded');
            } else {
                document.querySelectorAll('#keggPathways .gene-details').forEach(d => d.classList.remove('show'));
                document.querySelectorAll('#keggPathways .pathway-item').forEach(i => i.classList.remove('expanded'));
                
                details.classList.add('show');
                item.classList.add('expanded');
            }
        }

        // Reactome Charts
        function drawReactomeCharts() {
            const reactomeCtx = document.getElementById('reactomeChart').getContext('2d');
            if (charts.reactome) charts.reactome.destroy();
            
            charts.reactome = new Chart(reactomeCtx, {
                type: 'radar',
                data: {
                    labels: analysisData.reactome.pathways.map(p => p.name.substring(0, 20) + '...'),
                    datasets: [{
                        label: 'Pathway Score',
                        data: analysisData.reactome.pathways.map(p => p.score),
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: '#3498db',
                        pointBackgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Pathway list
            const reactomeHTML = analysisData.reactome.pathways.map(pathway => `
                <div class="pathway-item">
                    <div class="pathway-title">${pathway.name}</div>
                    <div class="pathway-stats">
                        <span class="stat-pill">${pathway.id}</span>
                        <span class="stat-pill">Score: ${pathway.score}</span>
                    </div>
                    <div class="gene-list">
                        Key genes: ${pathway.genes.join(', ')}
                    </div>
                </div>
            `).join('');
            document.getElementById('reactomePathways').innerHTML = reactomeHTML;
        }

        // Disease Ontology Charts
        function drawDOCharts() {
            const doCtx = document.getElementById('doChart').getContext('2d');
            if (charts.do) charts.do.destroy();
            
            charts.do = new Chart(doCtx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Disease Associations',
                        data: analysisData.diseases.associations.map((d, i) => ({
                            x: i,
                            y: d.score,
                            r: d.genes / 2
                        })),
                        backgroundColor: 'rgba(231, 76, 60, 0.6)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Association Score'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const disease = analysisData.diseases.associations[context.dataIndex];
                                    return `${disease.disease}: ${disease.genes} genes, Score: ${disease.score}`;
                                }
                            }
                        }
                    }
                }
            });

            // Disease table
            const tableHTML = analysisData.diseases.associations.map(d => `
                <tr>
                    <td>${d.disease}</td>
                    <td>Chronic Disease</td>
                    <td>${d.genes}</td>
                    <td>${d.score.toFixed(2)}</td>
                </tr>
            `).join('');
            document.getElementById('doTableBody').innerHTML = tableHTML;
        }

        // DisGeNET Charts
        function drawDisGeNETCharts() {
            const disgenetCtx = document.getElementById('disgenetChart').getContext('2d');
            if (charts.disgenet) charts.disgenet.destroy();
            
            charts.disgenet = new Chart(disgenetCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Gene-Disease Associations',
                        data: [
                            { x: 2.3, y: 3, gene: 'VEGFA' },
                            { x: 1.8, y: 2.5, gene: 'HIF1A' },
                            { x: -1.5, y: 2.8, gene: 'TP53' },
                            { x: 1.2, y: 2.2, gene: 'AKT1' },
                            { x: -0.8, y: 1.9, gene: 'PTEN' }
                        ],
                        backgroundColor: ['#e74c3c', '#e74c3c', '#3498db', '#e74c3c', '#3498db'],
                        pointRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Gene Expression (Log2 FC)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Disease Association Score'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.gene + ': FC=' + context.raw.x + ', Score=' + context.raw.y;
                                }
                            }
                        }
                    }
                }
            });

            // Create network visualization
            createDisGeNETNetwork();
        }

        // Gene Set Enrichment Analysis
        function drawGSEACharts() {
            const gseaCtx = document.getElementById('gseaChart').getContext('2d');
            if (charts.gsea) charts.gsea.destroy();
            
            const geneSets = [
                { name: 'Angiogenesis', es: 0.65, nes: 2.1, pval: 0.001 },
                { name: 'Lipid Metabolism', es: -0.58, nes: -1.9, pval: 0.002 },
                { name: 'Cell Cycle', es: 0.52, nes: 1.8, pval: 0.005 },
                { name: 'Apoptosis', es: -0.45, nes: -1.6, pval: 0.01 },
                { name: 'MAPK Signaling', es: 0.42, nes: 1.5, pval: 0.02 }
            ];
            
            charts.gsea = new Chart(gseaCtx, {
                type: 'bar',
                data: {
                    labels: geneSets.map(s => s.name),
                    datasets: [{
                        label: 'Normalized Enrichment Score',
                        data: geneSets.map(s => s.nes),
                        backgroundColor: geneSets.map(s => s.nes > 0 ? '#e74c3c' : '#3498db')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Gene Set Enrichment Scores'
                        }
                    }
                }
            });

            // Create enrichment plot
            createEnrichmentPlot();
        }

        // Oncogene Analysis
        function drawOncogeneCharts() {
            const oncogeneCtx = document.getElementById('oncogeneChart').getContext('2d');
            if (charts.oncogene) charts.oncogene.destroy();
            
            charts.oncogene = new Chart(oncogeneCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Oncogenes',
                        data: analysisData.oncogenes.filter(g => g.type === 'oncogene').map((g, i) => ({
                            x: g.fc,
                            y: g.cancers.length,
                            gene: g.gene
                        })),
                        backgroundColor: '#e74c3c',
                        pointRadius: 10
                    }, {
                        label: 'Tumor Suppressors',
                        data: analysisData.oncogenes.filter(g => g.type === 'tumor_suppressor').map((g, i) => ({
                            x: g.fc,
                            y: g.cancers.length,
                            gene: g.gene
                        })),
                        backgroundColor: '#3498db',
                        pointRadius: 10
                    }, {
                        label: 'Other',
                        data: analysisData.oncogenes.filter(g => g.type !== 'oncogene' && g.type !== 'tumor_suppressor').map((g, i) => ({
                            x: g.fc,
                            y: g.cancers.length,
                            gene: g.gene
                        })),
                        backgroundColor: '#2ecc71',
                        pointRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Expression Change (Log2 FC)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Associated Cancers'
                            }
                        }
                    }
                }
            });

            // Cancer type distribution
            const cancerCtx = document.getElementById('cancerTypeChart').getContext('2d');
            if (charts.cancer) charts.cancer.destroy();
            
            const cancerTypes = {};
            analysisData.oncogenes.forEach(g => {
                g.cancers.forEach(c => {
                    cancerTypes[c] = (cancerTypes[c] || 0) + 1;
                });
            });
            
            charts.cancer = new Chart(cancerCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(cancerTypes),
                    datasets: [{
                        data: Object.values(cancerTypes),
                        backgroundColor: [
                            '#e74c3c', '#3498db', '#2ecc71', '#f39c12', 
                            '#9b59b6', '#1abc9c', '#34495e', '#e67e22'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Cancer Type Distribution'
                        }
                    }
                }
            });

            // Oncogene table
            const tableHTML = analysisData.oncogenes.map(g => `
                <tr>
                    <td><strong>${g.gene}</strong></td>
                    <td>${g.type.replace('_', ' ')}</td>
                    <td class="${g.fc > 0 ? 'up' : 'down'}">${g.fc.toFixed(2)}</td>
                    <td>${g.cancers.join(', ')}</td>
                </tr>
            `).join('');
            document.getElementById('oncogeneTableBody').innerHTML = tableHTML;
        }

        // PPI Network
        function drawPPINetwork() {
            const width = 800;
            const height = 600;

            // Clear previous network
            d3.select("#ppiNetwork").selectAll("*").remove();

            const svg = d3.select("#ppiNetwork")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Sample network data
            const nodes = [
                { id: "VEGFA", fc: 1.9, degree: 8 },
                { id: "HIF1A", fc: 1.2, degree: 6 },
                { id: "AKT1", fc: 1.5, degree: 10 },
                { id: "TP53", fc: -1.5, degree: 12 },
                { id: "MTOR", fc: 0.8, degree: 7 },
                { id: "STAT3", fc: 1.1, degree: 5 },
                { id: "MAPK1", fc: 0.5, degree: 9 },
                { id: "PTEN", fc: -1.2, degree: 6 }
            ];

            const links = [
                { source: "VEGFA", target: "HIF1A" },
                { source: "HIF1A", target: "AKT1" },
                { source: "AKT1", target: "MTOR" },
                { source: "AKT1", target: "TP53" },
                { source: "TP53", target: "PTEN" },
                { source: "STAT3", target: "VEGFA" },
                { source: "MAPK1", target: "AKT1" },
                { source: "MTOR", target: "STAT3" }
            ];

            // Create force simulation
            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2));

            // Add links
            const link = svg.append("g")
                .selectAll("line")
                .data(links)
                .enter().append("line")
                .style("stroke", "#999")
                .style("stroke-width", 2);

            // Add nodes
            const node = svg.append("g")
                .selectAll("circle")
                .data(nodes)
                .enter().append("circle")
                .attr("r", d => 5 + d.degree)
                .style("fill", d => d.fc > 0 ? "#e74c3c" : "#3498db")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            // Add labels
            const label = svg.append("g")
                .selectAll("text")
                .data(nodes)
                .enter().append("text")
                .text(d => d.id)
                .style("font-size", "12px")
                .style("text-anchor", "middle");

            // Update positions
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("cx", d => d.x)
                    .attr("cy", d => d.y);

                label
                    .attr("x", d => d.x)
                    .attr("y", d => d.y - 15);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }

            // Hub genes
            const hubGenes = nodes.filter(n => n.degree > 7).map(n => n.id).join(', ');
            document.getElementById('hubGenes').innerHTML = hubGenes;

            // Network metrics
            document.getElementById('networkMetrics').innerHTML = `
                <div>Nodes: ${nodes.length}</div>
                <div>Edges: ${links.length}</div>
                <div>Average degree: ${(links.length * 2 / nodes.length).toFixed(1)}</div>
            `;
        }

        // Helper function to create DisGeNET network
        function createDisGeNETNetwork() {
            const width = 800;
            const height = 600;

            d3.select("#disgenetNetwork").selectAll("*").remove();

            const svg = d3.select("#disgenetNetwork")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Bipartite network: genes and diseases
            const genes = [
                { id: "VEGFA", type: "gene", fc: 1.9 },
                { id: "HIF1A", type: "gene", fc: 1.2 },
                { id: "AKT1", type: "gene", fc: 1.5 },
                { id: "TP53", type: "gene", fc: -1.5 },
                { id: "SCD", type: "gene", fc: -0.8 }
            ];

            const diseases = [
                { id: "Cancer", type: "disease" },
                { id: "Diabetes", type: "disease" },
                { id: "CVD", type: "disease" },
                { id: "Obesity", type: "disease" }
            ];

            const allNodes = [...genes, ...diseases];

            const links = [
                { source: "VEGFA", target: "Cancer" },
                { source: "VEGFA", target: "CVD" },
                { source: "HIF1A", target: "Cancer" },
                { source: "AKT1", target: "Cancer" },
                { source: "AKT1", target: "Diabetes" },
                { source: "TP53", target: "Cancer" },
                { source: "SCD", target: "Obesity" },
                { source: "SCD", target: "Diabetes" }
            ];

            const simulation = d3.forceSimulation(allNodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(150))
                .force("charge", d3.forceManyBody().strength(-400))
                .force("center", d3.forceCenter(width / 2, height / 2));

            const link = svg.append("g")
                .selectAll("line")
                .data(links)
                .enter().append("line")
                .style("stroke", "#999")
                .style("stroke-width", 1);

            const node = svg.append("g")
                .selectAll("g")
                .data(allNodes)
                .enter().append("g");

            node.append("rect")
                .attr("width", d => d.type === "disease" ? 80 : 60)
                .attr("height", 30)
                .attr("x", d => d.type === "disease" ? -40 : -30)
                .attr("y", -15)
                .attr("rx", 5)
                .style("fill", d => {
                    if (d.type === "disease") return "#f39c12";
                    return d.fc > 0 ? "#e74c3c" : "#3498db";
                });

            node.append("text")
                .text(d => d.id)
                .style("text-anchor", "middle")
                .style("alignment-baseline", "middle")
                .style("fill", "white")
                .style("font-size", "12px");

            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });
        }

        // Helper function to create enrichment plot
        function createEnrichmentPlot() {
            const width = 700;
            const height = 400;
            const margin = { top: 20, right: 30, bottom: 40, left: 50 };

            d3.select("#gseaPlot").selectAll("*").remove();

            const svg = d3.select("#gseaPlot")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Generate sample enrichment score data
            const n = 100;
            const data = [];
            let es = 0;
            for (let i = 0; i < n; i++) {
                es += (Math.random() - 0.45) * 0.1;
                data.push({ rank: i, es: es });
            }

            const xScale = d3.scaleLinear()
                .domain([0, n])
                .range([0, width - margin.left - margin.right]);

            const yScale = d3.scaleLinear()
                .domain([d3.min(data, d => d.es), d3.max(data, d => d.es)])
                .range([height - margin.top - margin.bottom, 0]);

            const line = d3.line()
                .x(d => xScale(d.rank))
                .y(d => yScale(d.es));

            g.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "#3498db")
                .attr("stroke-width", 2)
                .attr("d", line);

            g.append("g")
                .attr("transform", `translate(0,${height - margin.top - margin.bottom})`)
                .call(d3.axisBottom(xScale));

            g.append("g")
                .call(d3.axisLeft(yScale));

            g.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height - margin.top - margin.bottom) / 2)
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Enrichment Score");

            g.append("text")
                .attr("x", (width - margin.left - margin.right) / 2)
                .attr("y", height - margin.top - margin.bottom + 35)
                .style("text-anchor", "middle")
                .text("Gene Rank");
        }

        // Initialize on load
        window.addEventListener('load', initDashboard);
    </script>
</body>
</html>
